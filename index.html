<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Tích Điểm - Voucher</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs (Compat version) -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn-primary { background-color: #2563eb; color: white; }
        .btn-primary:hover { background-color: #1d4ed8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,env">
        const { useState, useEffect } = React;
        
        // --- Firebase Configuration ---
        const firebaseConfig = {
  apiKey: "AIzaSyDLQBLROJ1ABogfjll-9ucznO3tchy-4aE",
  authDomain: "shop-tich-diem.firebaseapp.com",
  projectId: "shop-tich-diem",
  storageBucket: "shop-tich-diem.firebasestorage.app",
  messagingSenderId: "767439185361",
  appId: "1:767439185361:web:a33131993aa244f4cc2cf0",
  measurementId: "G-3JZ18BHBD5"
};

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = window.__app_id || 'loyalty-voucher-v1';

        // --- Helpers ---
        const getCollectionRef = (name) => {
            return db.collection('artifacts').doc(appId).collection('public').doc('data').collection(name);
        };
        const getUserRef = (phone) => {
            return getCollectionRef('users').doc(phone);
        };
        const getVoucherRef = (code) => {
            return getCollectionRef('vouchers').doc(code);
        };

        // Tạo mã ngẫu nhiên: VD: GIFT-8X92
        const generateCode = () => {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Bỏ các ký tự dễ nhầm lẫn (I, 1, O, 0)
            let result = '';
            for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
            return `GIFT-${result}`;
        };

        // --- Components ---

        const Notification = ({ message, type, onClose }) => {
            if (!message) return null;
            const bgClass = type === 'success' ? 'bg-green-100 text-green-800 border-green-200' : 'bg-red-100 text-red-800 border-red-200';
            return (
                <div className={`fixed top-4 right-4 z-50 px-4 py-3 rounded-lg border shadow-lg flex items-center gap-2 animate-fade-in ${bgClass}`}>
                    <i className={`fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}`}></i>
                    <span>{message}</span>
                    <button onClick={onClose} className="ml-2 hover:opacity-75"><i className="fas fa-times"></i></button>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home'); // home, admin, customer
            const [notification, setNotification] = useState({ msg: '', type: '' });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (window.__initial_auth_token) {
                            await auth.signInWithCustomToken(window.__initial_auth_token);
                        } else {
                            await auth.signInAnonymously();
                        }
                    } catch (error) {
                        console.error("Auth error:", error);
                    }
                };
                initAuth();
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const showNotify = (msg, type = 'success') => {
                setNotification({ msg, type });
                setTimeout(() => setNotification({ msg: '', type: '' }), 4000);
            };

            if (loading) return <div className="min-h-screen flex items-center justify-center bg-gray-50"><i className="fas fa-spinner fa-spin text-blue-600 text-3xl"></i></div>;

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans">
                    <Notification message={notification.msg} type={notification.type} onClose={() => setNotification({ msg: '', type: '' })} />
                    
                    <header className="bg-white shadow-sm sticky top-0 z-40">
                        <div className="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer hover:opacity-80 transition" onClick={() => setView('home')}>
                                <div className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-blue-200">
                                    <i className="fas fa-gift"></i>
                                </div>
                                <div>
                                    <h1 className="font-bold text-lg leading-tight text-gray-800">Loyalty App</h1>
                                    <p className="text-xs text-gray-500">Tích điểm đổi quà</p>
                                </div>
                            </div>
                            {view !== 'home' && (
                                <button onClick={() => setView('home')} className="text-sm font-medium text-gray-500 hover:text-blue-600 transition flex items-center gap-1">
                                    <i className="fas fa-arrow-left"></i> Trang chủ
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-8">
                        {view === 'home' && <HomeView setView={setView} />}
                        {view === 'admin' && <AdminView user={user} showNotify={showNotify} />}
                        {view === 'customer' && <CustomerView user={user} showNotify={showNotify} />}
                    </main>

                    <footer className="text-center py-6 text-gray-400 text-xs">
                        <p>© 2024 Hệ thống tích điểm - Phiên bản Voucher</p>
                    </footer>
                </div>
            );
        };

        const HomeView = ({ setView }) => (
            <div className="flex flex-col items-center justify-center py-10 gap-8 animate-fade-in">
                <div className="text-center mb-2">
                    <h2 className="text-3xl font-bold text-gray-900 mb-2">Xin chào!</h2>
                    <p className="text-gray-600">Vui lòng chọn vai trò để tiếp tục</p>
                </div>
                
                <div className="grid md:grid-cols-2 gap-6 w-full max-w-2xl px-4">
                    <button 
                        onClick={() => setView('customer')}
                        className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 border border-gray-100 flex flex-col items-center gap-4 group cursor-pointer"
                    >
                        <div className="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center text-blue-600 text-3xl group-hover:bg-blue-600 group-hover:text-white transition-colors duration-300">
                            <i className="fas fa-user"></i>
                        </div>
                        <h3 className="text-xl font-bold text-gray-800">Khách Hàng</h3>
                        <p className="text-gray-500 text-center text-sm">Đăng ký, tích điểm và nhập mã thưởng.</p>
                    </button>

                    <button 
                        onClick={() => setView('admin')}
                        className="bg-white p-8 rounded-2xl shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 border border-gray-100 flex flex-col items-center gap-4 group cursor-pointer"
                    >
                        <div className="w-20 h-20 bg-purple-50 rounded-full flex items-center justify-center text-purple-600 text-3xl group-hover:bg-purple-600 group-hover:text-white transition-colors duration-300">
                            <i className="fas fa-cogs"></i>
                        </div>
                        <h3 className="text-xl font-bold text-gray-800">Quản Trị Viên</h3>
                        <p className="text-gray-500 text-center text-sm">Tạo mã thưởng và quản lý danh sách.</p>
                    </button>
                </div>
            </div>
        );

        const AdminView = ({ user, showNotify }) => {
            const [activeTab, setActiveTab] = useState('create-code'); // create-code, list
            const [pointValue, setPointValue] = useState('');
            const [generatedCode, setGeneratedCode] = useState('');
            const [usersList, setUsersList] = useState([]);
            const [pin, setPin] = useState('');
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isSubmitting, setIsSubmitting] = useState(false);

            // Fetch users list logic
            useEffect(() => {
                if (!isAuthenticated || activeTab !== 'list') return;
                const unsubscribe = getCollectionRef('users').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
                    const users = snapshot.docs.map(doc => doc.data());
                    setUsersList(users);
                });
                return () => unsubscribe();
            }, [activeTab, isAuthenticated]);

            const handleCreateCode = async (e) => {
                e.preventDefault();
                if (!pointValue || parseInt(pointValue) <= 0) return showNotify("Vui lòng nhập số điểm hợp lệ", "error");

                setIsSubmitting(true);
                try {
                    const newCode = generateCode();
                    const voucherData = {
                        code: newCode,
                        value: parseInt(pointValue),
                        status: 'active', // active, used
                        createdBy: 'admin',
                        createdAt: new Date().toISOString()
                    };

                    await getVoucherRef(newCode).set(voucherData);
                    setGeneratedCode(newCode);
                    showNotify("Tạo mã thành công!", "success");
                    setPointValue('');
                } catch (error) {
                    showNotify("Lỗi: " + error.message, "error");
                }
                setIsSubmitting(false);
            };

            // Login Logic
            if (!isAuthenticated) {
                return (
                    <div className="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-lg text-center animate-fade-in mt-10">
                        <div className="mb-4 text-purple-600 text-4xl"><i className="fas fa-lock"></i></div>
                        <h3 className="text-xl font-bold mb-2">Khu vực quản trị</h3>
                        <p className="text-gray-500 mb-6 text-sm">Nhập mật khẩu quản trị để tiếp tục</p>
                        <form onSubmit={(e) => {
                            e.preventDefault();
                            if (pin === '2209') setIsAuthenticated(true);
                            else showNotify('Mật khẩu không đúng', 'error');
                        }}>
                            <input 
                                type="password" 
                                className="w-full p-3 border border-gray-300 rounded-lg mb-4 text-center text-2xl tracking-widest outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500"
                                maxLength="4"
                                value={pin}
                                onChange={(e) => setPin(e.target.value)}
                                placeholder="****"
                                autoFocus
                            />
                            <button type="submit" className="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition">
                                Đăng Nhập
                            </button>
                        </form>
                    </div>
                );
            }

            // Main Admin UI
            return (
                <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden animate-fade-in min-h-[400px]">
                    <div className="flex border-b">
                        <button 
                            onClick={() => setActiveTab('create-code')}
                            className={`flex-1 py-4 font-medium text-sm transition-colors ${activeTab === 'create-code' ? 'bg-purple-50 text-purple-700 border-b-2 border-purple-600' : 'text-gray-500 hover:bg-gray-50'}`}
                        >
                            <i className="fas fa-plus-circle mr-2"></i>Tạo Mã Thưởng
                        </button>
                        <button 
                            onClick={() => setActiveTab('list')}
                            className={`flex-1 py-4 font-medium text-sm transition-colors ${activeTab === 'list' ? 'bg-purple-50 text-purple-700 border-b-2 border-purple-600' : 'text-gray-500 hover:bg-gray-50'}`}
                        >
                            <i className="fas fa-users mr-2"></i>Danh Sách KH
                        </button>
                    </div>

                    <div className="p-6">
                        {activeTab === 'create-code' && (
                            <div className="max-w-md mx-auto">
                                <div className="text-center mb-6">
                                    <h3 className="text-xl font-bold text-gray-800">Phát Hành Mã Điểm</h3>
                                    <p className="text-sm text-gray-500">Tạo mã để gửi cho khách hàng nhập</p>
                                </div>

                                <form onSubmit={handleCreateCode} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Giá trị điểm thưởng</label>
                                        <div className="relative">
                                            <input 
                                                type="number" 
                                                value={pointValue}
                                                onChange={e => setPointValue(e.target.value)}
                                                className="w-full p-4 pl-12 border rounded-xl focus:ring-2 focus:ring-purple-500 outline-none text-lg font-bold"
                                                placeholder="VD: 100"
                                                required
                                            />
                                            <div className="absolute left-4 top-4 text-gray-400">
                                                <i className="fas fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <button disabled={isSubmitting} type="submit" className="w-full bg-purple-600 text-white py-4 rounded-xl font-bold hover:bg-purple-700 transition shadow-lg shadow-purple-200">
                                        {isSubmitting ? 'Đang tạo...' : 'Tạo Mã Ngay'}
                                    </button>
                                </form>

                                {generatedCode && (
                                    <div className="mt-8 bg-green-50 border border-green-200 rounded-xl p-6 text-center animate-fade-in">
                                        <p className="text-green-800 text-sm mb-2 font-medium">Mã thưởng vừa tạo:</p>
                                        <div className="bg-white border-2 border-dashed border-green-400 rounded-lg p-3 mb-3 cursor-pointer hover:bg-green-50" onClick={() => {navigator.clipboard.writeText(generatedCode); showNotify('Đã sao chép mã!');}}>
                                            <span className="text-3xl font-black text-green-700 tracking-wider font-mono">{generatedCode}</span>
                                        </div>
                                        <p className="text-xs text-gray-500">Gửi mã này cho khách hàng để họ tự nhập vào hệ thống.</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'list' && (
                            <div>
                                <h3 className="text-lg font-bold text-gray-800 mb-4">Thành viên đã đăng ký ({usersList.length})</h3>
                                <div className="overflow-x-auto border rounded-lg">
                                    <table className="w-full text-left text-sm">
                                        <thead className="bg-gray-50 text-gray-600 uppercase text-xs">
                                            <tr>
                                                <th className="p-3">Thông tin</th>
                                                <th className="p-3 text-right">Điểm Tích Lũy</th>
                                                <th className="p-3 text-right">Ngày ĐK</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y">
                                            {usersList.map((u) => (
                                                <tr key={u.phoneNumber} className="hover:bg-gray-50">
                                                    <td className="p-3">
                                                        <div className="font-bold text-gray-800">{u.name}</div>
                                                        <div className="text-gray-500 text-xs">{u.phoneNumber}</div>
                                                    </td>
                                                    <td className="p-3 text-right">
                                                        <span className="bg-blue-100 text-blue-700 px-2 py-1 rounded-md font-bold text-xs">{u.currentPoints} điểm</span>
                                                    </td>
                                                    <td className="p-3 text-right text-gray-500 text-xs">
                                                        {u.createdAt ? new Date(u.createdAt).toLocaleDateString('vi-VN') : '-'}
                                                    </td>
                                                </tr>
                                            ))}
                                            {usersList.length === 0 && (
                                                <tr><td colSpan="3" className="p-6 text-center text-gray-400">Chưa có dữ liệu</td></tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const CustomerView = ({ user, showNotify }) => {
            const [mode, setMode] = useState('login'); // login, register, dashboard
            const [phone, setPhone] = useState('');
            const [name, setName] = useState('');
            const [voucherCode, setVoucherCode] = useState('');
            const [userData, setUserData] = useState(null);
            const [history, setHistory] = useState([]);
            const [isProcessing, setIsProcessing] = useState(false);

            // Fetch history when user is loaded
            useEffect(() => {
                if (mode === 'dashboard' && userData) {
                    const unsubscribe = getCollectionRef('transactions')
                        .where('phoneNumber', '==', userData.phoneNumber) // Note: Requires index in Firestore for complex queries, keeping simple for now
                        .onSnapshot((snapshot) => {
                            const trans = [];
                            snapshot.forEach(doc => trans.push(doc.data()));
                            // Sort manually
                            trans.sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                            setHistory(trans);
                        });
                    return () => unsubscribe();
                }
            }, [mode, userData]);

            const handleRegister = async (e) => {
                e.preventDefault();
                setIsProcessing(true);
                try {
                    const userRef = getUserRef(phone);
                    const docSnap = await userRef.get();
                    if (docSnap.exists) {
                        showNotify('Số điện thoại này đã được đăng ký. Vui lòng đăng nhập.', 'error');
                        setMode('login');
                    } else {
                        const newUser = {
                            name: name,
                            phoneNumber: phone,
                            currentPoints: 0,
                            createdAt: new Date().toISOString()
                        };
                        await userRef.set(newUser);
                        showNotify('Đăng ký thành công!');
                        setUserData(newUser);
                        setMode('dashboard');
                    }
                } catch (err) {
                    showNotify('Lỗi: ' + err.message, 'error');
                }
                setIsProcessing(false);
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                setIsProcessing(true);
                try {
                    const userRef = getUserRef(phone);
                    const docSnap = await userRef.get();
                    if (docSnap.exists) {
                        setUserData(docSnap.data());
                        setMode('dashboard');
                        showNotify('Đăng nhập thành công');
                    } else {
                        showNotify('Số điện thoại chưa đăng ký. Vui lòng đăng ký mới.', 'error');
                        setMode('register');
                    }
                } catch (err) {
                    showNotify('Lỗi: ' + err.message, 'error');
                }
                setIsProcessing(false);
            };

            const handleRedeemCode = async (e) => {
                e.preventDefault();
                if (!voucherCode) return;
                setIsProcessing(true);

                try {
                    const code = voucherCode.trim().toUpperCase();
                    const voucherRef = getVoucherRef(code);
                    const voucherSnap = await voucherRef.get();

                    if (!voucherSnap.exists) {
                        throw new Error("Mã thưởng không tồn tại");
                    }

                    const voucherData = voucherSnap.data();
                    if (voucherData.status !== 'active') {
                        throw new Error("Mã này đã được sử dụng");
                    }

                    // Perform updates
                    const newPoints = (userData.currentPoints || 0) + voucherData.value;
                    
                    // 1. Mark voucher as used
                    await voucherRef.update({
                        status: 'used',
                        usedBy: userData.phoneNumber,
                        usedAt: new Date().toISOString()
                    });

                    // 2. Update user points
                    await getUserRef(userData.phoneNumber).update({
                        currentPoints: newPoints
                    });

                    // 3. Log transaction
                    await getCollectionRef('transactions').add({
                        phoneNumber: userData.phoneNumber,
                        amount: voucherData.value,
                        type: 'earn',
                        rewardCode: code,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Update local state
                    setUserData({ ...userData, currentPoints: newPoints });
                    setVoucherCode('');
                    showNotify(`Thành công! Bạn nhận được ${voucherData.value} điểm.`);

                } catch (error) {
                    showNotify(error.message, 'error');
                }
                setIsProcessing(false);
            };

            const handleLogout = () => {
                setUserData(null);
                setMode('login');
                setPhone('');
                setName('');
            }

            // --- RENDER CUSTOMER VIEWS ---

            if (mode === 'login') {
                return (
                    <div className="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-sm border border-gray-100 animate-fade-in">
                        <div className="text-center mb-6">
                            <h3 className="text-xl font-bold text-gray-800">Khách Hàng Đăng Nhập</h3>
                            <p className="text-gray-500 text-sm">Nhập số điện thoại để tra cứu & tích điểm</p>
                        </div>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input 
                                type="tel" 
                                value={phone}
                                onChange={e => setPhone(e.target.value)}
                                className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="Số điện thoại của bạn"
                                required
                            />
                            <button disabled={isProcessing} type="submit" className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition">
                                {isProcessing ? 'Đang kiểm tra...' : 'Tiếp Tục'}
                            </button>
                        </form>
                        <div className="mt-4 text-center">
                            <button onClick={() => setMode('register')} className="text-blue-600 text-sm hover:underline">Chưa có tài khoản? Đăng ký ngay</button>
                        </div>
                    </div>
                );
            }

            if (mode === 'register') {
                return (
                    <div className="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-sm border border-gray-100 animate-fade-in">
                        <div className="text-center mb-6">
                            <h3 className="text-xl font-bold text-gray-800">Đăng Ký Thành Viên</h3>
                            <p className="text-gray-500 text-sm">Nhập thông tin để tạo thẻ thành viên mới</p>
                        </div>
                        <form onSubmit={handleRegister} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Họ và Tên</label>
                                <input 
                                    type="text" 
                                    value={name}
                                    onChange={e => setName(e.target.value)}
                                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                    placeholder="VD: Nguyễn Văn A"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Số điện thoại</label>
                                <input 
                                    type="tel" 
                                    value={phone}
                                    onChange={e => setPhone(e.target.value)}
                                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                    placeholder="0912..."
                                    required
                                />
                            </div>
                            <button disabled={isProcessing} type="submit" className="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition shadow-lg shadow-green-200">
                                {isProcessing ? 'Đang xử lý...' : 'Hoàn Tất Đăng Ký'}
                            </button>
                        </form>
                        <div className="mt-4 text-center">
                            <button onClick={() => setMode('login')} className="text-gray-500 text-sm hover:text-gray-700">Đã có tài khoản? Quay lại</button>
                        </div>
                    </div>
                );
            }

            // Dashboard View
            return (
                <div className="space-y-6 animate-fade-in">
                    {/* Header Info */}
                    <div className="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 text-white shadow-lg flex justify-between items-start relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-10 text-6xl"><i className="fas fa-wallet"></i></div>
                        <div className="relative z-10">
                            <p className="text-blue-200 text-xs uppercase tracking-wider mb-1">Thẻ Thành Viên</p>
                            <h2 className="text-2xl font-bold">{userData.name}</h2>
                            <p className="text-blue-200 font-mono text-sm mb-4">{userData.phoneNumber}</p>
                            <div className="flex items-end gap-2">
                                <span className="text-5xl font-bold">{userData.currentPoints}</span>
                                <span className="text-blue-200 mb-1 font-medium">điểm</span>
                            </div>
                        </div>
                        <button onClick={handleLogout} className="relative z-10 bg-white/20 hover:bg-white/30 p-2 rounded-lg backdrop-blur-sm transition">
                            <i className="fas fa-sign-out-alt"></i>
                        </button>
                    </div>

                    {/* Redeem Section */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i className="fas fa-qrcode text-blue-600"></i> Nạp Điểm Thưởng
                        </h3>
                        <form onSubmit={handleRedeemCode} className="flex gap-2">
                            <input 
                                type="text" 
                                value={voucherCode}
                                onChange={e => setVoucherCode(e.target.value)}
                                className="flex-1 p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none uppercase font-bold text-gray-700 placeholder-gray-400"
                                placeholder="Nhập mã thưởng (VD: GIFT-1234)"
                                required
                            />
                            <button disabled={isProcessing} type="submit" className="bg-blue-600 text-white px-6 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-200">
                                {isProcessing ? <i className="fas fa-spinner fa-spin"></i> : 'Nạp'}
                            </button>
                        </form>
                        <p className="text-xs text-gray-400 mt-2 ml-1">* Nhập mã do quản trị viên cung cấp để cộng điểm.</p>
                    </div>

                    {/* Transaction History */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 pb-2 border-b">Lịch sử giao dịch</h3>
                        <div className="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                            {history.length > 0 ? history.map((t, idx) => (
                                <div key={idx} className="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center">
                                            <i className="fas fa-arrow-down"></i>
                                        </div>
                                        <div>
                                            <p className="font-bold text-gray-800 text-sm">Nạp điểm thưởng</p>
                                            <p className="text-xs text-gray-500 font-mono">Code: {t.rewardCode}</p>
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <p className="font-bold text-green-600">+{t.amount}</p>
                                        <p className="text-xs text-gray-400">
                                            {t.timestamp ? new Date(t.timestamp.seconds * 1000).toLocaleDateString('vi-VN') : 'Vừa xong'}
                                        </p>
                                    </div>
                                </div>
                            )) : (
                                <div className="text-center py-8 text-gray-400">
                                    <i className="fas fa-history text-3xl mb-2 opacity-50"></i>
                                    <p className="text-sm">Chưa có giao dịch nào</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>